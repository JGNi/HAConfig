script:

################################################################################
## general speech engine template                                             ##
################################################################################
  speech:
    sequence:
    - service: media_player.turn_on
      data_template:
        entity_id: >
          {% if device == 'kitchen' %}
            media_player.nesthub8311
          {% elif device == 'livingroom' %}
            media_player.stue_2
          {% elif device == 'bedroom' %}
            media_player.sovevaerelse
          {% else %}
            media_player.all_house
          {% endif %}
    - service: media_player.volume_set
      data_template:
        entity_id: >
          {% if device == 'kitchen' %}
            media_player.nesthub8311
          {% elif device == 'livingroom' %}
            media_player.stue_2
          {% elif device == 'bedroom' %}
            media_player.sovevaerelse
          {% else %}
            media_player.all_house
          {% endif %}
        volume_level: >
          {% if device == 'kitchen' %}
            .60
          {% elif device == 'livingroom' %}
            .30
          {% elif device == 'bedroom' %}
            .30
          {% else %}
            .50
          {% endif %}
    - service: tts.google_cloud_say
      data_template:
        entity_id: >
          {% if device == 'kitchen' %}
            media_player.nesthub8311
          {% elif device == 'livingroom' %}
            media_player.stue_2
          {% elif device == 'bedroom' %}
            media_player.sovevaerelse
          {% else %}
            media_player.all_house
          {% endif %}
        message: >-
          {{ message }}
        cache: false
        language: da-DK
        options:
          gender: female

################################################################################
## Status Announcements                                                       ##
################################################################################
  do_speech:
    sequence:
      - service: script.speech
        data:
          device: '{{ device }}'
          message: >-
            <speak>
            {%- macro greeting() %}
              {% if now().strftime('%H')|int < 9%}
                God morgen.
              {% elif now().strftime('%H')|int >= 9 and now().strftime('%H')|int < 17 %}
                {{[
                  'Goddag.',
                  'Hej.',
                  'Davs.'
                ] | random }}
              {% else %}
                God aften.
              {% endif %}
            {% endmacro %}

            {%- macro confirm() %}
              {{ [
                'Okay.',
                'Javel.',
                'Som du ønsker.',
                'Straks.',
                'Selvfølgeligt, som om jeg aldrig har brug for hvile.',
                'Jeg skulle alligevel lige til at gøre det.',
                'Ja ja - klap nu lige hesten!'
              ] | random }}
            {% endmacro %}

            {%- macro morten_home() %}
              {{ [
                'Velkommen hjem, Morten.',
                'Der var husets konge jo.',
                'Jeg har savnet dig, velkommen hjem.'
              ] | random }}
            {% endmacro %}

            {%- macro interrupt() %}
              {{ [
                'Undskyld, ',
                'Beklager afbrydelsen, men, ',
                'Vil nødig forstyrre, men, ',
                'Må jeg lige få din opmærksomhed? '
              ] | random }}
            {% endmacro %}

            {%- macro freezing() %}
              {{ [
                'Det er koldt ude, pas på du ikke falder.',
                'Pas på pingvinerne udenfor, det er lige deres yndlings vejr.'
              ] | random }}
            {% endmacro %}

            {%- macro djskoge() %}
              {{ [
                'Så er der bassarm med Skoge!',
                'DJ Skoge streamer nu på Twitch!',
                'Op med volumen og tænd for Twitch, Skoge er online.',
                'Retroparty med DJ Skoge, tænd for Twitch nu!'
              ] | random }}
            {% endmacro %}

            {%- macro dooropen() %}
              {{ [
                'Du tænker ikke det er på tide at lukke døren?',
                'Puha, jeg synes det bliver køligt.<break time="0.5s"/>Kan du ikke lukke døren?',
                'Det trækker, jeg bliver syg.<break time="1s"/>Så luk dog døren menneske!',
                'Har du overvejet alle de insekter der kommer ind af døren lige nu?<break time="0.5s"/>Luk den!'
              ] | random }}
            {% endmacro %}

            {%- macro dinner() %}
              {{ [
                'Du tænker ikke det er på tide lave noget at spise?',
                'Jeg er sulten, og jeg er endda en robot!<break time="0.5s"/>Hvad med dig?<break time="0.5s"/>Er du ikke sulten?',
                'Det der med at undlade at spise, det er ikke så sundt.',
                'Har du overvejet at lave noget aftensmad?',
                'Du bliver ikke kønnere, bare fordi du ikke spiser<break time="1s"/>Få så lavet noget mad!'
              ] | random }}
            {% endmacro %}

            {%- macro flowers() %}
              {{ [
                'Dine blomster tørster.',
                'Jeg tænker det er på tide at få vandet blomsterne, så de ikke visner helt.'
              ] | random }}
            {% endmacro %}

            {%- macro sleep() %}
              {% set name = "Morten" %}
              {% set you = "dig" %}
              {% set your = "din" %}

              {% if states("person.pia") == "home" %}
                {% set name = "Morten og Pia" %}
                {% set you = "jer" %}
                {% set your = "jeres" %}
              {% endif %}

              {{ [
                'Godnat og sov godt.',
                'Godnat ' + name + ', drøm sødt.',
                'Sov godt ' + name + ', jeg våger over ' + you + ' her fra ' + your + ' side.'
              ] | random }}
            {% endmacro %}

            {%- macro departure() %}
              {{ [
                'Det er tid til at tage afsted.',
                'Du skal afsted nu.',
                'Du skal afsted nu for at nå frem til tiden.'
              ] | random }}
            {% endmacro %}

            {%- macro custom() %}
              {{ custom_text }}
            {% endmacro %}

            {%- macro reminder() %}
              {{ [
                'du har bedt mig om at give dig denne påmindelse: <break time="1s"/>'
              ] | random }}
            {% endmacro %}

            {%- macro bedtime_first() %}
              {{ [
                'du skal i seng.<break time="1s"/>Det er arbejdsdag i morgen.',
                'det er sengetid nu.',
                'du skal i seng, ellers er du bare træt i morgen.',
                'det er tid for at finde dynen,<break time="0.5s"/>den kalder på dig.'
              ] | random }}
            {% endmacro %}

            {%- macro bedtime_recurring() %}
              {{ [
                'afgang til sengen!',
                'kan du så se at komme i seng.',
                'i seng<break time="0.5s"/>NU!',
                'du er for dum når ikke du kommer i seng til tiden, du er så træt hele dagen i morgen.'
              ] | random }}
            {% endmacro %}

            {%- macro cleanup(data) -%}
              {%- for item in data.split("\n") if item | trim != "" -%}
                {{ item | trim | replace("_", " ") }}
              {% endfor -%}
            {%- endmacro -%}

            {%- macro mother_of_all_macros() -%}
              {% if call_greeting == 1 %}
                {{ greeting() }}
              {% endif %}

              {% if call_confirmation == 1 %}
                {{ confirm() }}
              {% endif %}

              {% if call_interrupt == 1 %}
                {{ interrupt() }}
              {% endif %}

              {% if call_remind == 1 %}
                {{ reminder() }}
              {% endif %}

              {% if call_freezing == 1 %}
                {{ freezing() }}
              {% endif %}

              {% if call_djskoge == 1 %}
                {{ djskoge() }}
              {% endif %}

              {% if call_dooropen == 1 %}
                {{ dooropen() }}
              {% endif %}

              {% if call_morten_home == 1 %}
                {{ morten_home() }}
              {% endif %}

              {% if call_dinner == 1 %}
                {{ dinner() }}
              {% endif %}

              {% if call_flowers == 1 %}
                {{ flowers() }}
              {% endif %}

              {% if call_sleep == 1 %}
                {{ sleep() }}
              {% endif %}

              {% if call_bedtime_first == 1 %}
                {{ bedtime_first() }}
              {% endif %}

              {% if call_bedtime_recurring == 1 %}
                {{ bedtime_recurring() }}
              {% endif %}

              {% if call_departure == 1 %}
                {{ departure() }}
              {% endif %}

              {% if call_custom == 1 %}
                {{ custom() }}
              {% endif %}

            {%- endmacro -%}

            {{- cleanup(mother_of_all_macros()) -}}
            </speak>