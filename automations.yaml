- id: '1602097080450'
  alias: Auto - Turn on Vitrine when sun goes down
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
    from: above_horizon
    to: below_horizon
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  action:
  - type: turn_on
    device_id: 7298c1c5058d72f733c3e1bc167f6a31
    entity_id: light.vitrine
    domain: light
    brightness_pct: 100
  mode: single
- id: '1602155183627'
  alias: Light - Livingroom - Desktop Switch
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.switch_desktop_click
    id: desktop_on
    to: 'on'
  - platform: state
    entity_id: sensor.switch_desktop_click
    id: desktop_off
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: desktop_on
      sequence:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.desktop
    - conditions:
      - condition: trigger
        id: desktop_off
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.desktop
    default: []
  mode: queued
  max: 10
- id: '1602228352429'
  alias: Auto - Set TV volume
  description: ''
  trigger:
  - platform: state
    entity_id: media_player.stue
    attribute: source
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.stue
        state: TV
        attribute: source
      sequence:
      - service: media_player.volume_set
        target:
          entity_id: media_player.stue
        data:
          volume_level: 0.25
    default:
    - service: media_player.volume_set
      target:
        entity_id: media_player.stue
      data:
        volume_level: 0.12
  mode: single
- id: '1602610466182'
  alias: Auto - Turn on some lights when dark and coming home
  description: ''
  trigger:
  - platform: state
    to: home
    entity_id: person.morten_trab
  - platform: state
    entity_id: device_tracker.kia_niro
    to: home
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - type: turn_on
    device_id: 7298c1c5058d72f733c3e1bc167f6a31
    entity_id: light.vitrine
    domain: light
    brightness_pct: 100
  - type: turn_on
    device_id: 008fa23255e5932cab33819bdbd02707
    entity_id: light.outside
    domain: light
    brightness_pct: 100
  - service: switch.turn_on
    target:
      entity_id: switch.store_stearinlys
    data: {}
  mode: single
- id: '1605100832268'
  alias: State - Toggle away mode
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.away_mode
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.away_mode
        state: 'on'
      sequence:
      - service: switch.turn_off
        target:
          entity_id:
          - switch.schedule_heat_floor_in_bedroom
          - switch.schedule_normal_heating
          - switch.schedule_normal_heating_when_working_from_home
          - switch.schedule_weekend_heating
        data: {}
      - service: climate.set_temperature
        data:
          temperature: 18
        target:
          device_id:
          - dcda4e53071311eb96e5c56d002656e1
          - dcdb16b4071311eb8ae06bbcb7b0ee4d
          - eb8fa3cd070d11eb93e1f3123b152cc3
      - service: climate.set_temperature
        data:
          temperature: 18
        target:
          entity_id: climate.bedroom
      - service: climate.set_temperature
        data:
          temperature: 20
        target:
          entity_id:
          - climate.hall
          - climate.toilet
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.allow_auto_charge
        data: {}
    default:
    - service: switch.turn_on
      target:
        entity_id:
        - switch.schedule_heat_floor_in_bedroom
        - switch.schedule_normal_heating
        - switch.schedule_normal_heating_when_working_from_home
        - switch.schedule_weekend_heating
      data: {}
  mode: single
- id: '1606586819683'
  alias: Auto - Turn off lights if on after 02:00 AM
  description: ''
  trigger:
  - platform: time
    at: 02:00
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id:
      - switch.store_stearinlys
      - light.vitrine
      - light.outside
    data: {}
  mode: single
- id: '1608025961275'
  alias: Alert - Doorbell
  description: Afspil lyd i Sonos, ved tryk på dørklokke knappen
  trigger:
  - platform: state
    entity_id: sensor.switch_doorbell_click
    to: 'on'
  condition:
  - condition: time
    after: 06:00:00
    before: '22:00'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''person.morten_trab'') != ''home'' }}'
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: Det ringede på døren {{ now().strftime("%H:%M %d-%m-%Y") }}
          data:
            subject: Det ringer på døren
            group: Doorbell
            channel: Doorbell
            importance: high
            vibrationPattern: 100, 200, 50, 200, 100, 200, 50, 200
    default: []
  - service: sonos.snapshot
    data: {}
    entity_id: media_player.stue, media_player.sovevaerelse_2
  - service: media_player.volume_set
    data:
      volume_level: 0.4
    entity_id: media_player.stue, media_player.sovevaerelse_2
  - service: media_player.play_media
    data:
      media_content_id: https://home.trab.dk/local/doorbell/jetsons.mp3
      media_content_type: music
    target:
      entity_id: media_player.stue, media_player.sovevaerelse_2
  - delay: 00:00:05
  - service: sonos.restore
    data: {}
    entity_id: media_player.stue, media_player.sovevaerelse_2
  - delay: 00:00:05
  mode: single
- id: '1608633503593'
  alias: Light - Kitchen - Motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 2642707e9101945dd6ea4c464ad271fb
    entity_id: binary_sensor.motion_kitchen_occupancy
    domain: binary_sensor
  condition:
  - type: is_illuminance
    condition: device
    device_id: 2642707e9101945dd6ea4c464ad271fb
    entity_id: sensor.motion_kitchen_illuminance_lux
    domain: sensor
    below: 45
  action:
  - choose:
    - conditions:
      - condition: time
        after: '23:00'
        before: 05:00
        weekday:
        - mon
        - tue
        - wed
        - thu
      sequence:
      - type: turn_on
        device_id: 4a227f89647f36e7186f52cf6145e2a5
        entity_id: light.kitchen
        domain: light
        brightness_pct: 20
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 2642707e9101945dd6ea4c464ad271fb
          entity_id: binary_sensor.motion_kitchen_occupancy
          domain: binary_sensor
    - conditions:
      - condition: time
        weekday:
        - fri
        after: '23:59'
        before: 05:00
      sequence:
      - type: turn_on
        device_id: 4a227f89647f36e7186f52cf6145e2a5
        entity_id: light.kitchen
        domain: light
        brightness_pct: 20
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 2642707e9101945dd6ea4c464ad271fb
          entity_id: binary_sensor.motion_kitchen_occupancy
          domain: binary_sensor
    - conditions:
      - condition: time
        after: '23:59'
        before: 07:00
        weekday:
        - sat
      sequence:
      - type: turn_on
        device_id: 4a227f89647f36e7186f52cf6145e2a5
        entity_id: light.kitchen
        domain: light
        brightness_pct: 20
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 2642707e9101945dd6ea4c464ad271fb
          entity_id: binary_sensor.motion_kitchen_occupancy
          domain: binary_sensor
    - conditions:
      - condition: time
        after: '23:00'
        before: 07:00
        weekday:
        - sun
      sequence:
      - type: turn_on
        device_id: 4a227f89647f36e7186f52cf6145e2a5
        entity_id: light.kitchen
        domain: light
        brightness_pct: 20
      - wait_for_trigger:
        - type: no_motion
          platform: device
          device_id: 2642707e9101945dd6ea4c464ad271fb
          entity_id: binary_sensor.motion_kitchen_occupancy
          domain: binary_sensor
    default:
    - type: turn_on
      device_id: 4a227f89647f36e7186f52cf6145e2a5
      entity_id: light.kitchen
      domain: light
      brightness_pct: 100
    - wait_for_trigger:
      - type: no_motion
        platform: device
        device_id: 2642707e9101945dd6ea4c464ad271fb
        entity_id: binary_sensor.motion_kitchen_occupancy
        domain: binary_sensor
        for:
          hours: 0
          minutes: 13
          seconds: 0
  - type: turn_off
    device_id: 4a227f89647f36e7186f52cf6145e2a5
    entity_id: light.kitchen
    domain: light
  mode: restart
- id: '1611133656102'
  alias: Light - Dartskab
  description: ''
  trigger:
  - type: not_opened
    platform: device
    device_id: 7f52f701942c349294baa275140379da
    entity_id: binary_sensor.dw_dartskab_contact_2
    domain: binary_sensor
    id: 'off'
  - type: opened
    platform: device
    device_id: 7f52f701942c349294baa275140379da
    entity_id: binary_sensor.dw_dartskab_contact_2
    domain: binary_sensor
    id: 'on'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - type: turn_off
        device_id: 4ad8b54946a4396c55e39e47011bfde3
        entity_id: light.dartskab
        domain: light
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: turn_on
        device_id: 4ad8b54946a4396c55e39e47011bfde3
        entity_id: light.dartskab
        domain: light
        brightness_pct: 100
    default: []
  mode: restart
- id: '1611135152192'
  alias: Auto - Standby power management - Night
  description: Forsøg at minimere standby forbrug
  trigger:
  - platform: time
    at: 01:00:00
    id: 'off'
  - platform: time
    at: 05:00:00
    id: 'on'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'off'
      - type: is_power
        condition: device
        device_id: 0d38e72afcf2f15fd920c0edcaa4b47d
        entity_id: sensor.kaffemaskine_electric_w
        domain: sensor
        below: 2.5
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id:
          - switch.coffeemaker_switch
    default: []
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: switch.turn_on
        data: {}
        target:
          entity_id: switch.coffeemaker_switch
    default: []
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: turn_on
        device_id: d23fd4714c9b7008d771a5e948643bbc
        entity_id: switch.skrivebord
        domain: switch
    default: []
  mode: single
- id: '1612350036408'
  alias: Auto - Outside Lights - Dusk - Auto On
  description: ''
  trigger:
  - platform: sun
    event: sunset
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  action:
  - type: turn_on
    device_id: 008fa23255e5932cab33819bdbd02707
    entity_id: light.outside
    domain: light
    brightness_pct: 10
  mode: single
- id: '1612426582410'
  alias: Auto - Outside Lights - Morning - On
  description: ''
  trigger:
  - platform: time
    at: 05:00
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  action:
  - type: turn_on
    device_id: 008fa23255e5932cab33819bdbd02707
    entity_id: light.outside
    domain: light
    brightness_pct: 10
  mode: single
- id: '1612426754916'
  alias: Light - Outside - Motion
  description: Køres kun når lyset er tændt
  trigger:
  - type: motion
    platform: device
    device_id: 0eef5c198c5181734a12c9f75118782d
    entity_id: binary_sensor.motion_outside_occupancy
    domain: binary_sensor
    id: 'on'
  - type: no_motion
    platform: device
    device_id: 0eef5c198c5181734a12c9f75118782d
    entity_id: binary_sensor.motion_outside_occupancy
    domain: binary_sensor
    id: 'off'
    for:
      hours: 0
      minutes: 3
      seconds: 0
  condition:
  - condition: device
    type: is_on
    device_id: 008fa23255e5932cab33819bdbd02707
    entity_id: light.outside
    domain: light
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: turn_on
        device_id: 008fa23255e5932cab33819bdbd02707
        entity_id: light.outside
        domain: light
        brightness_pct: 100
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - type: turn_on
        device_id: 008fa23255e5932cab33819bdbd02707
        entity_id: light.outside
        domain: light
        brightness_pct: 10
    default: []
  mode: single
- id: '1612506618068'
  alias: Auto - Turn off at dawn
  description: ''
  trigger:
  - platform: sun
    event: sunrise
  condition: []
  action:
  - type: turn_off
    device_id: 008fa23255e5932cab33819bdbd02707
    entity_id: light.outside
    domain: light
  mode: single
- id: '1612785517695'
  alias: Auto - Leaving Home
  description: ''
  trigger:
  - platform: state
    entity_id: group.any_home
    from: home
    to: not_home
    for: 00:02:00
    id: 2min
  - platform: state
    entity_id: group.any_home
    id: 30min
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 30
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 2min
      sequence:
      - service: media_player.media_stop
        entity_id: all
        data: {}
      - service: light.turn_off
        entity_id: all
        data: {}
    - conditions:
      - condition: trigger
        id: 30min
      sequence:
      - service: switch.turn_off
        target:
          entity_id:
          - switch.coffeemaker_switch
        data: {}
    default: []
  mode: single
- id: '1612785626004'
  alias: Auto - Coming Home
  description: Do specific stuff when coming home
  trigger:
  - platform: state
    entity_id: group.any_home
    from: not_home
    to: home
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: sun.sun
        state: below_horizon
      sequence:
      - service: automation.trigger
        data: {}
        entity_id: automation.light_dusk_outside_auto_on
      - service: automation.trigger
        data: {}
        entity_id: automation.turn_on_vitrine_when_sun_goes_down
    default: []
  - choose:
    - conditions:
      - condition: time
        after: 05:00:00
      - condition: sun
        before: sunrise
        after: sunset
      sequence:
      - service: automation.trigger
        data: {}
        entity_id: automation.light_outside_morning_on
    default: []
  - type: turn_on
    device_id: d23fd4714c9b7008d771a5e948643bbc
    entity_id: switch.skrivebord
    domain: switch
  - type: turn_on
    device_id: 8ae93b9b7711ca61eaa526e03b81f43f
    entity_id: switch.coffeemaker_switch
    domain: switch
  mode: single
- id: '1612814644449'
  alias: Alert - Smoke Detected
  description: ''
  trigger:
  - type: smoke
    platform: device
    device_id: e322f928712824c67f5124a8f16de3ab
    entity_id: binary_sensor.smoke_livingroom_smoke_alarm_smoke_detected
    domain: binary_sensor
  - type: smoke
    platform: device
    device_id: 159c7c744b771fc0d96223790acba2ff
    entity_id: binary_sensor.smoke_bedroom_smoke_alarm_smoke_detected_2
    domain: binary_sensor
  condition: []
  action:
  - service: notify.mobile_app_mtopnord2
    data:
      message: command_ringer_mode
      title: normal
  - delay: 00:00:02
  - service: notify.mobile_app_mtopnord2
    data:
      message: '!!! RØG DETEKTERET !!!'
      data:
        subject: RØG DETEKTERET
        group: SMOKE
        channel: alarm_stream_max
        importance: high
        priority: high
        ttl: 0
  mode: single
- id: '1615284560741'
  alias: Auto - Toilet - Humidity Exhaust
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.toilet_hygrostat
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.toilet_fan
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.toilet_hygrostat
      from: 'on'
      to: 'off'
    timeout: 03:00:00
  - service: switch.turn_off
    target:
      entity_id: switch.toilet_fan
  mode: single
- id: '1615289935324'
  alias: Light - Hall - Motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 2730e60e031583ecdf5f9955fecd93c1
    entity_id: binary_sensor.motion_hall_occupancy
    domain: binary_sensor
  condition:
  - type: is_illuminance
    condition: device
    device_id: 2730e60e031583ecdf5f9955fecd93c1
    entity_id: sensor.motion_hall_illuminance_lux
    domain: sensor
    below: 130
  action:
  - service: light.turn_on
    target:
      device_id: aa1e532da567f3e46f9253fc839e7ec2
    data:
      transition: 5
  - wait_for_trigger:
    - type: motion
      platform: device
      device_id: 2730e60e031583ecdf5f9955fecd93c1
      entity_id: binary_sensor.motion_hall_occupancy
      domain: binary_sensor
      for:
        hours: 0
        minutes: 1
        seconds: 0
  - type: turn_off
    device_id: aa1e532da567f3e46f9253fc839e7ec2
    entity_id: light.gang_loftlys
    domain: light
  mode: restart
- id: '1616055451211'
  alias: Light - Bathroom - Motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 81ea100cddbc37e859b313545da9a019
    entity_id: binary_sensor.motion_bathroom_occupancy
    domain: binary_sensor
  condition: []
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.toilet
    data: {}
  - wait_for_trigger:
    - type: no_motion
      platform: device
      device_id: 81ea100cddbc37e859b313545da9a019
      entity_id: binary_sensor.motion_bathroom_occupancy
      domain: binary_sensor
      for:
        hours: 0
        minutes: 5
        seconds: 0
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.toilet_fan
        state: 'on'
        for:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0
      sequence:
      - delay:
          hours: 0
          minutes: 30
          seconds: 0
          milliseconds: 0
    default: []
  - service: switch.turn_off
    target:
      entity_id: switch.toilet
    data: {}
  mode: restart
- id: '1632209322025'
  alias: Auto - Detect low battery and notify
  description: ''
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      threshold: 25
      time: '17:00:00'
      exclude:
        entity_id:
        - sensor.mtopnord2_battery_level
      actions:
      - service: notify.mobile_app_mtopnord2
        data:
          message: 'Low battery detected on: {{sensors}}'
- id: '1633628292945'
  alias: Auto - Turn on candles when sun goes down
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
    from: above_horizon
    to: below_horizon
  condition:
  - condition: state
    entity_id: group.any_home
    state: home
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.store_stearinlys
  mode: single
- id: '1634541207719'
  alias: TTS - Greeting when coming home
  description: ''
  trigger:
  - platform: state
    entity_id: person.morten_trab
    to: home
  condition:
  - condition: time
    after: 00:00
    before: '21:00'
  action:
  - wait_for_trigger:
    - type: opened
      platform: device
      device_id: ec95542199d8f7d4a19d1f246c15a2ef
      entity_id: binary_sensor.dw_frontdoor_contact
      domain: binary_sensor
    continue_on_timeout: false
    timeout: 00:05:00
  - wait_for_trigger:
    - type: motion
      platform: device
      device_id: 2642707e9101945dd6ea4c464ad271fb
      entity_id: binary_sensor.motion_kitchen_occupancy
      domain: binary_sensor
    continue_on_timeout: false
    timeout: 00:05:00
  - service: script.do_speech
    data:
      call_morten_home: 1
      device: kitchen
  mode: restart
- id: '1634544090085'
  alias: TTS - DJ Skoge Stremer
  description: Giv besked når Skoge streamer
  trigger:
  - platform: state
    entity_id: sensor.djskoge
    from: offline
    to: streaming
    for:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  condition:
  - condition: time
    after: '10:00:00'
    before: '22:00:00'
  action:
  - service: sonos.snapshot
    data: {}
    entity_id: media_player.stue
  - service: script.do_speech
    data:
      device: livingroom
      call_interrupt: 1
      call_djskoge: 1
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: sonos.restore
    data: {}
    entity_id: media_player.stue
  mode: single
- id: '1634544242311'
  alias: TTS - Reminder - Frontdoor is open
  description: Reminding to close the frontdoor
  trigger:
  - platform: time
    at: '21:00'
  condition:
  - type: is_open
    condition: device
    device_id: ec95542199d8f7d4a19d1f246c15a2ef
    entity_id: binary_sensor.dw_frontdoor_contact
    domain: binary_sensor
  action:
  - service: media_player.volume_mute
    data:
      is_volume_muted: false
    target:
      entity_id: media_player.stue
  - service: script.do_speech
    data:
      device: livingroom
      call_interrupt: 1
      call_dooropen: 1
  mode: single
- id: '1637156442232'
  alias: Auto - Work From Home?
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.work_from_home
    id: cal
  - platform: state
    entity_id: binary_sensor.workday_sensor
    to: 'off'
    id: wds
  - platform: time
    at: 00:00:00
    id: time
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: cal
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: calendar.work_from_home
            state: 'on'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.is_home
            data: {}
        - conditions:
          - condition: state
            entity_id: binary_sensor.workday_sensor
            state: 'on'
          - condition: state
            entity_id: calendar.work_from_home
            state: 'off'
          sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.is_home
            data: {}
        default: []
    - conditions:
      - condition: trigger
        id: wds
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'off'
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.is_home
        data: {}
    - conditions:
      - condition: trigger
        id: time
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: calendar.work_from_home
            state: 'on'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.is_home
            data: {}
        - conditions:
          - condition: state
            entity_id: binary_sensor.workday_sensor
            state: 'on'
          - condition: state
            entity_id: calendar.work_from_home
            state: 'off'
          sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.is_home
            data: {}
        default:
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.is_home
          data: {}
    default:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.is_home
      data: {}
  mode: single
- id: '1637178851136'
  alias: Alert - WAN and VPN connections statechange
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.wan_connection
  - platform: state
    entity_id: binary_sensor.vpn_horsensvej
  - platform: state
    entity_id: binary_sensor.vpn_ivan
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state != trigger.from_state.state }}'
  action:
  - service: notify.mobile_app_mtopnord2
    data_template:
      message: '{{ trigger.from_state.name }} skiftede fra {{ trigger.from_state.state
        }} til {{ trigger.to_state.state }}'
  mode: queued
  max: 10
- id: '1637443580844'
  alias: Auto - Kia Niro - Travel Time - Origin Update
  description: ''
  trigger:
  - platform: state
    entity_id: device_tracker.mtopnord2
    attribute: latitude
  - platform: state
    entity_id: device_tracker.mtopnord2
    attribute: longitude
  - platform: state
    entity_id: device_tracker.mtopnord2
  condition: []
  action:
  - service: input_text.set_value
    target:
      entity_id: input_text.google_origin
    data:
      value: "{% if states(\"device_tracker.mtopnord2\") == \"not_home\" %}\n  {{\
        \ state_attr(\"device_tracker.mtopnord2\", \"latitude\") }}, {{state_attr(\"\
        device_tracker.mtopnord2\", \"longitude\") }}\n{% else %}\n  {{ states(\"\
        device_tracker.mtopnord2\") }}\n{% endif %}"
  mode: restart
- id: '1637574947818'
  alias: Notification - Remind Departure
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.time_until_departure
    to: '10'
  condition: []
  action:
  - service: notify.mobile_app_mtopnord2
    data:
      message: Du skal afsted om 10 minutter
      data:
        title: Det er ved at være tid til afgang
        importance: high
        channel: calendar_departure
        vibrationPattern: 50, 500, 50, 500, 50, 500, 50, 500
  mode: single
- id: '1638190307088'
  alias: Notification - Medical reminder - Morning
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No Morning Medication Answer Time Out
      reminder_time: 06:30:00
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_morgen
      notification_title: Husk medicin
      notification_message: Det er tid til at tage din medicin
      notification_action_taken: Taget
      notification_action_later: Spørg senere
      notification_action_skip: Spring over
      logbook_message_remind: Morning Medication Reminder Sent
      logbook_message_taken: Morning Medication Taken
      logbook_message_later: Postpone Morning Medication Reminder
      logbook_message_skip: Morning Medication Reminder Skipped
      ask_later_wait_time: 60
- id: '1638363003788'
  alias: Auto - Webasto - Turn Off When Getting Near Zone
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: proximity.morten_home
    below: '15'
  condition:
  - condition: state
    entity_id: proximity.morten_home
    state: towards
    attribute: dir_of_travel
  - condition: state
    entity_id: switch.webasto
    state: 'on'
  action:
  - service: shell_command.webasto_off
  mode: single
- id: '1640077919167'
  alias: Notification - Prepare dinner
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No answer time out for dinner reminder
      notify_device: 5a203dc793181fba91d8220b160558c1
      notification_title: Det er tid for aftensmad
      notification_message: Husk at du skal lave aftensmad
      notification_action_taken: Igang
      notification_action_later: Senere
      notification_action_skip: Ikke i dag
      logbook_message_remind: Reminder sent for dinner
      logbook_message_taken: Dinner done
      logbook_message_later: Dinner later
      logbook_message_skip: Dinner skipped
      optional_action: []
      reminder_time: '18:00:00'
      input_boolean: input_boolean.dinner_reminder
- id: '1640082213543'
  alias: TTS - Reminder - Dinner
  description: Påmindelse for aftensmad
  trigger:
  - platform: time
    at: '17:30'
  condition: []
  action:
  - service: sonos.snapshot
    data: {}
    entity_id: media_player.stue
  - service: script.do_speech
    data:
      device: livingroom
      call_interrupt: 1
      call_dinner: 1
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: sonos.restore
    data: {}
    entity_id: media_player.stue
  mode: single
- id: '1640082318900'
  alias: TTS - Reminder - Water the flowers
  description: Påmindelse at vande blomsterne
  trigger:
  - platform: time
    at: '21:00'
  condition:
  - condition: time
    weekday:
    - sun
  action:
  - service: sonos.snapshot
    data: {}
    entity_id: media_player.stue
  - service: script.do_speech
    data:
      device: livingroom
      call_interrupt: 1
      call_flowers: 1
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: sonos.restore
    data: {}
    entity_id: media_player.stue
  mode: single
- id: '1641207894004'
  alias: TTS - Calendar Notification
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.automations
    id: TTS
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: calendar.automations
    state: TTS
    attribute: message
  action:
  - service: script.do_speech
    data:
      device: livingroom
      call_interrupt: 1
      call_remind: 1
      call_custom: 1
      custom_text: '{{ state_attr("calendar.automations","description") }}'
  mode: single
- id: '1642950827716'
  alias: Auto - Actions at morning alarm when working at home
  description: ''
  trigger:
  - platform: time
    at: sensor.google_sovevaerelse_alarms
  condition:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: state
    entity_id: input_boolean.is_home
    state: 'on'
  action:
  - wait_for_trigger:
    - type: motion
      platform: device
      device_id: 2730e60e031583ecdf5f9955fecd93c1
      entity_id: binary_sensor.motion_hall_occupancy
      domain: binary_sensor
    timeout: 01:00:00
    continue_on_timeout: false
  - service: switch.turn_on
    target:
      entity_id: switch.toilet
    data: {}
  - type: turn_on
    device_id: 3b6afdd5aff2138e80230367beebc215
    entity_id: switch.kaffemaskine_power
    domain: switch
  - service: switch.turn_on
    target:
      entity_id:
      - switch.pc
      - switch.skrivebord
    data: {}
  - service: media_player.play_media
    data:
      media_content_id: http://live-icy.dr.dk/A/A14H.mp3
      media_content_type: music
    target:
      entity_id: media_player.stue
  - service: media_player.volume_mute
    data:
      is_volume_muted: false
    target:
      entity_id: media_player.stue
  - service: light.turn_on
    target:
      entity_id:
      - light.spisebord
      - light.kitchen
    data: {}
  mode: single
- id: '1642951260065'
  alias: Auto - Core A8 - Turn off when job is done
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.core_a8_printing
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition: []
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.core_a8_power
  mode: restart
- id: '1644826763466'
  alias: TTS - Bedtime
  description: ''
  trigger:
  - platform: time
    at: input_datetime.bedtime
  condition:
  - condition: state
    entity_id: sensor.google_sovevaerelse_alarms
    state: unavailable
  - condition: state
    entity_id: person.morten_trab
    state: home
  - condition: state
    entity_id: binary_sensor.workday_tomorrow
    state: 'on'
  action:
  - service: script.do_speech
    data:
      device: livingroom
      call_interrupt: 1
      call_bedtime_first: 1
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.google_sovevaerelse_alarms
        state: unavailable
      sequence:
      - service: script.go_to_bed_reminder
        data: {}
    default: []
  mode: single
- id: '1645448355621'
  alias: TTS - Departure Time Reached
  description: ''
  trigger:
  - platform: time
    at: input_datetime.car_departure_time
  condition:
  - condition: state
    entity_id: input_boolean.charge_time_override
    state: 'on'
  action:
  - service: script.do_speech
    data:
      device: kitchen
      call_departure: 1
  mode: single
- id: '1645621979465'
  alias: Infopanel - Update events
  description: ''
  trigger:
  - platform: time_pattern
    minutes: '30'
  condition: []
  action:
  - service: pyscript.infopanel_get_calendar_event
    data:
      count: 3
  mode: single
- id: '1645947896203'
  alias: Notification - Camera detected motion
  description: ''
  trigger:
  - platform: mqtt
    topic: frigate/events
  condition:
  - condition: template
    value_template: '{% set lastChange = as_timestamp(states.binary_sensor.dw_frontdoor_contact.last_changed,
      0) %}

      {{ (now() - timedelta(minutes=2)).timestamp() > lastChange }}'
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''camera''] == ''door'' }}'
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''top_score''] > 0.79 }}'
  action:
  - service: notify.mobile_app_mtopnord2
    data:
      message: Person registreret
      title: Der blev registreret en person ved døren
      data:
        image: /api/frigate/notifications/{{trigger.payload_json["after"]["id"]}}/thumbnail.jpg?format=android
        tag: '{{trigger.payload_json["after"]["id"]}}'
        when: '{{trigger.payload_json["after"]["start_time"]|int}}'
        ttl: 0
        clickAction: /frontdoor-cam/0
  mode: single
- id: '1646049336210'
  alias: Notification - Medical reminder - Evening
  description: ''
  use_blueprint:
    path: Aohzan/medication_reminder.yaml
    input:
      logbook_message_no_answer: No Evening Medication Answer Time Out
      reminder_time: '17:30:00'
      notify_device: 5a203dc793181fba91d8220b160558c1
      input_boolean: input_boolean.husket_medicin_aften
      notification_title: Husk medicin
      notification_message: Det er tid til at tage din medicin
      notification_action_taken: Taget
      notification_action_later: Spørg senere
      notification_action_skip: Spring over
      logbook_message_remind: Evening Medication Reminder Sent
      logbook_message_taken: Evening Medication Taken
      logbook_message_later: Postpone Evening Medication Reminder
      logbook_message_skip: Evening Medication Reminder Skipped
      ask_later_wait_time: 60
- id: '1646160179333'
  alias: Light - Livingroom - Wallswitch
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: d505e0f192b8babfc01e577a91b55f74
    type: action
    subtype: 'on'
    discovery_id: 0xccccccfffe56b58e action_on
    id: 'on'
  - platform: device
    domain: mqtt
    device_id: d505e0f192b8babfc01e577a91b55f74
    type: action
    subtype: 'off'
    discovery_id: 0xccccccfffe56b58e action_off
    id: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.desktop
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: toggle
        device_id: c5d3112ba73f80cd24bab7d6f3aad278
        entity_id: light.deathstar
        domain: light
    default: []
  mode: parallel
  max: 5
- id: '1646161061514'
  alias: Light - Diningroom
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 2874b894e4c1bdce32ee9699888d16f3
    type: click
    subtype: 'on'
    discovery_id: 0xccccccfffea4ba3b click_on
    id: 'on'
  - platform: device
    domain: mqtt
    device_id: 2874b894e4c1bdce32ee9699888d16f3
    type: click
    subtype: 'off'
    discovery_id: 0xccccccfffea4ba3b click_off
    id: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.spisebord
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.spisebord
    default: []
  mode: single
- id: '1646572919441'
  alias: Auto - Climate - Toggle Climate When Window Opens
  description: ''
  trigger:
  - platform: state
    entity_id: group.dw_bedroom
    id: bedroom
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - platform: state
    entity_id: binary_sensor.dw_toilet_window_contact
    id: toilet
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - platform: state
    entity_id: binary_sensor.dw_frontdoor_contact
    id: hall
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - platform: state
    entity_id: group.dw_kitchen
    id: kitchen
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - platform: state
    entity_id: group.dw_diningroom
    id: diningroom
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - platform: state
    entity_id: group.dw_livingroom
    id: livingroom
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: livingroom
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_livingroom
            state: 'on'
          sequence:
          - service: climate.turn_off
            data: {}
            target:
              device_id: eb8fa3cd070d11eb93e1f3123b152cc3
        default:
        - service: climate.turn_on
          data: {}
          target:
            device_id: eb8fa3cd070d11eb93e1f3123b152cc3
    - conditions:
      - condition: trigger
        id: bedroom
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_bedroom
            state: 'on'
          sequence:
          - service: climate.set_hvac_mode
            data:
              hvac_mode: 'off'
            target:
              entity_id: climate.bedroom
        default:
        - service: climate.set_hvac_mode
          data:
            hvac_mode: auto
          target:
            entity_id: climate.bedroom
    - conditions:
      - condition: trigger
        id: toilet
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.dw_toilet_window_contact
            state: 'on'
          sequence:
          - service: climate.set_hvac_mode
            data:
              hvac_mode: 'off'
            target:
              entity_id: climate.toilet
        default:
        - service: climate.set_hvac_mode
          data:
            hvac_mode: auto
          target:
            entity_id: climate.toilet
    - conditions:
      - condition: trigger
        id: hall
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.dw_frontdoor_contact
            state: 'on'
          sequence:
          - service: climate.set_hvac_mode
            data:
              hvac_mode: 'off'
            target:
              entity_id: climate.hall
        default:
        - service: climate.set_hvac_mode
          data:
            hvac_mode: auto
          target:
            entity_id: climate.hall
    - conditions:
      - condition: trigger
        id: kitchen
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_kitchen
            state: 'on'
          sequence:
          - service: climate.turn_off
            data: {}
            target:
              device_id: dcda4e53071311eb96e5c56d002656e1
        default:
        - service: climate.turn_on
          data: {}
          target:
            device_id: dcda4e53071311eb96e5c56d002656e1
    - conditions:
      - condition: trigger
        id: diningroom
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: group.dw_diningroom
            state: 'on'
          sequence:
          - service: climate.turn_off
            data: {}
            target:
              device_id: dcdb16b4071311eb8ae06bbcb7b0ee4d
        default:
        - service: climate.turn_on
          data: {}
          target:
            device_id: dcdb16b4071311eb8ae06bbcb7b0ee4d
    default: []
  mode: queued
- id: '1646753316288'
  alias: Notification - Person detected
  description: ''
  use_blueprint:
    path: hunterjm/frigate_notification.yaml
    input:
      camera: Door
      notify_device: 5a203dc793181fba91d8220b160558c1
      notify_group: FrontdoorCam
- id: '1647420649275'
  alias: Auto - Set DND mode on mobile phone
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.silence
    id: 'on'
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: calendar.silence
    id: 'off'
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: command_dnd
          title: total_silence
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: notify.mobile_app_mtopnord2
        data:
          message: command_dnd
          title: 'off'
    default: []
  mode: single
- id: '1649146214519'
  alias: Vacuum - Automate run and dock
  description: ''
  trigger:
  - platform: state
    entity_id: group.any_home
    to: not_home
    from: home
    for:
      hours: 1
      minutes: 0
      seconds: 0
    id: run
  - platform: state
    entity_id: group.any_home
    from: not_home
    to: home
    id: dock
  - platform: template
    value_template: "{% set direction = trigger.to_state.attributes.dir_of_travel\
      \ %}\n{% set distance = trigger.to_state.state %}\n\n{% if direction == towards\
      \ and distance < 15 %}\n true\n{% else %}\n false\n{% endif %}"
    id: dock
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: run
      sequence:
      - device_id: db6d034e17793357be5133ee64e87489
        domain: vacuum
        entity_id: vacuum.wall_e
        type: clean
    default:
    - condition: trigger
      id: dock
    - device_id: db6d034e17793357be5133ee64e87489
      domain: vacuum
      entity_id: vacuum.wall_e
      type: dock
  mode: queued
  max: 5
